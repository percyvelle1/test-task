# DevOps Test Task

## О проекте
Это тестовое задание, где я показываю базовые навыки DevOps:  
- контейнеризация Python‑приложения,  
- настройка обратного прокси на Nginx,  
- автоматизация деплоя через Jenkins,  
- деплой в несколько реплик с балансировкой,  
- обновления без простоя (zero‑downtime).

По сути — маленький, но законченный стенд для проверки идей и демонстрации рабочего подхода.

---

## Структура проекта
```
devops-test/
├─ app/                # Python/Flask приложение
│  ├─ Dockerfile
│  ├─ app.py
│  └─ requirements.txt
├─ nginx/              # Nginx конфигурация
│  ├─ Dockerfile
│  └─ default.conf
├─ docker-compose.yml  # описание сервисов
└─ Jenkinsfile         # пайплайн для CI/CD
```

---

## Как всё работает

### Приложение (app)
- Базовый образ: `python:3.12-slim`.
- Двухэтапная сборка (сначала зависимости, потом код).
- Запускается на `:3000` и возвращает простое `Hello, World!`.
- Поддерживает healthcheck для проверки доступности.

### Nginx
- Настроен как reverse proxy перед приложением.
- Использует `upstream` для балансировки между несколькими контейнерами.
- Отдельный эндпоинт `/healthz` для мониторинга.

### Docker Compose
- Поднимает сервисы: `app` и `nginx`.
- Все сервисы объединены в сеть `web`.
- Для Nginx выделен volume под логи.

---

## Локальный запуск
```bash
git clone https://github.com/percyvelle1/test-task.git
cd test-task/devops-test

# создаём .env
echo "PORT=3000" > .env
echo "DEBUG=1" >> .env

# собираем и запускаем контейнеры
docker compose up -d --build
```

Проверка:
```bash
curl http://localhost
curl http://localhost/healthz
```

---

## CI/CD через Jenkins
- Подключен GitHub webhook → пуш в `main` триггерит деплой.
- Этапы пайплайна:
  1. SSH на сервер.
  2. `git pull` последней версии.
  3. Сборка и запуск контейнеров в несколько реплик:
     ```bash
     docker compose up -d --scale app=2 --no-deps --build app
     ```
  4. Проверка доступности через Nginx.

---

## Zero‑downtime деплой
- Минимум 2 реплики приложения.
- При обновлении один контейнер пересобирается, второй продолжает обслуживать трафик.
- Nginx балансирует запросы, пользователи не видят ошибок.

---

## Логи
Приложение:
```bash
docker compose logs -f app
```
Nginx:
```bash
docker compose logs -f nginx
```

---

## Результат
- Код обёрнут в Docker‑образы.  
- Nginx настроен как балансировщик и прокси.  
- Jenkins обеспечивает автоматический деплой.  
- Обновления происходят без простоя.  

Этот проект — рабочая демонстрация, как можно организовать DevOps‑процесс от контейнеризации до zero‑downtime релиза.
