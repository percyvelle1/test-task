# DevOps Test Task

## Описание
Тестовое задание: контейнеризация Python-приложения, настройка Nginx как обратного прокси и автоматизация деплоя через Jenkins.  
Сделан деплой в несколько реплик и обновления без простоя (zero-downtime).

---

## Структура проекта
```
devops-test/
├─ app/                # Python/Flask приложение
│  ├─ Dockerfile
│  ├─ app.py
│  └─ requirements.txt
├─ nginx/              # Nginx конфигурация
│  ├─ Dockerfile
│  └─ default.conf
├─ docker-compose.yml  # описание сервисов
└─ Jenkinsfile         # пайплайн для CI/CD
```

---

## Как работает

### Приложение (app)
- Базируется на `python:3.12-slim`.
- Используется двухэтапный билд: сначала собираются зависимости, потом копируется код.
- По умолчанию запускается на порту `3000` и выводит `Hello, World!`.

### Nginx
- Работает как reverse proxy и прокидывает трафик на `app`.
- В конфиге настроен `upstream` для балансировки между несколькими контейнерами.
- Добавлен эндпоинт `/healthz` для проверки состояния.

### Docker Compose
- Поднимает 2 сервиса: `app` и `nginx`.
- Все сервисы в одной сети `web`.
- Логи Nginx сохраняются в отдельный volume.

---

## Запуск вручную
```bash
git clone https://github.com/percyvelle1/test-task.git
cd test-task/devops-test

# создаём .env
echo "PORT=3000" > .env
echo "DEBUG=1" >> .env

# сборка и запуск контейнеров
docker compose up -d --build
```

Проверка:
```bash
curl http://localhost
curl http://localhost/healthz
```

---

## CI/CD (Jenkins)
- Jenkins подключён к GitHub через **webhook** → пуш в ветку `main` автоматически запускает деплой.
- Этапы пайплайна:
  1. Подключение по SSH к серверу.
  2. Обновление репозитория.
  3. Пересборка контейнеров и запуск в 2 реплики:
     ```bash
     docker compose up -d --scale app=2 --no-deps --build app
     ```
  4. Проверка доступности через Nginx.

---

## Zero-downtime деплой
- Приложение всегда работает минимум в двух экземплярах.
- При пересборке обновляется один контейнер, второй остаётся рабочим.
- Nginx балансирует трафик, поэтому пользователи не видят ошибок 502.

---

## Логи
- Приложение:
  ```bash
  docker compose logs -f app
  ```
- Nginx:
  ```bash
  docker compose logs -f nginx
  ```

---

## Итог
- Приложение контейнеризовано.  
- Nginx настроен как обратный прокси.  
- Автоматический деплой через Jenkins настроен.  
- Обновления происходят без простоя благодаря масштабированию.  
